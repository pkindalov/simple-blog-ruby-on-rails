<!-- app/views/posts/index.html.erb -->
<!DOCTYPE html>
<html>
<head>
  <title>Posts</title>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "application", "data-turbo-track": "reload", defer: true, type: "module" %>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>
<body>
<div class="container mt-5">
  <h1 class="mb-4">All Posts</h1>

  <div class="d-flex gap-4 w-100 justify-content-between">
    <%= link_to 'ğŸˆ Create New Post', new_post_path, class: 'btn btn-primary mb-3' %>
    <%= render "layouts/filter_posts" %>
  </div>


  <% @posts.each do |post| %>
    <div class="card mb-3">
      <div class="card-body">
        <% if post && post.photos.attached? %>
          <%= image_tag url_for(post.photos[0]), class: 'card-img-top img-fluid w-25', alt: 'Post Image' %>
        <% else %>
          <%= image_tag 'default_image.png', class: 'card-img-top img-fluid w-25', alt: 'Default Image' %>
        <% end %>
        <h5 class="card-title mt-3 mb-5">ğŸ–‹ <%= post.title %></h5>
        <hr />
        <p class="card-text">ğŸ‘ Viewed <%= post.views_count %> times</p>
        <p class="card-text">ğŸ“ <%= post.description %></p>
        <p class="card-text">ğŸ“· Photos <%= post.photos.count %></p>
        <p class="card-text">Likes ğŸ‘: <%= post.likes.count %></p>
        <p class="card-text mb-5">ğŸ“… <small class="text-muted">Posted on <%= post.created_at.strftime("%d %B %Y") %></small></p>
        <% if post.user_id == current_user.id %>
          <%= link_to 'ğŸ–Š Edit', edit_post_path(post), class: 'btn btn-primary mx-2' %>
          <%= link_to 'âŒ Delete', post, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' %>
      <% end %>
        <%= link_to 'ğŸ‘€ Show', post_path(post), class: 'btn btn-info' %>
        <% unless current_user == post.user %>
          <% if already_liked?(post) %>
            <%= link_to post_like_path(post, post.likes.find_by(user_id: current_user.id)), method: :delete, class: 'btn btn-primary' do %>
              ğŸ‘ Unlike
            <% end %>
          <% else %>
            <%= link_to post_likes_path(post), method: :post, class: 'btn btn-primary' do %>
              ğŸ‘ Like
            <% end %>
          <% end %>
        <% end %>

        <a href="#" class="btn disabled">ğŸ‘¥ ğŸ‘<%= post.likes.count %></a>
      </div>
    </div>
  <% end %>
  <div class="text-center">
    <%= will_paginate @posts, renderer: BootstrapPagination::Rails %>
  </div>
</div>
</body>
</html>
